<!DOCTYPE html>
<html lang="en">

<head>

<!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Obiettivi">
<meta name="author" content="Play">

<title>Gierre - Obiettivi</title>




<!-- Custom fonts for this template-->
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

<!-- Custom styles for this template-->
<link href="css/sb-admin-2.min.css" rel="stylesheet">

<!-- Custom styles for the TABLE -->
<link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">


<style>

 .obj-img {
/* The image used */
background-image: url("https://banner2.cleanpng.com/20180428/vke/kisspng-personal-goal-setting-thought-skill-5ae4d32b78f9c5.3349232515249457074955.jpg");

min-height: 380px;

/* Center and scale the image nicely */
background-position: center;
background-repeat: no-repeat;
background-size: cover;
position: relative;
}


</style>


<style>
 .disabled {
     color: white;
     pointer-events: none;
     cursor: default;
  
 }
  
  
  input::placeholder {
  color: red;
}
  

  
  
  
</style>
  
  
  
  
  
  
  
  <!--LOADING WHEEL-->
<!--<link href="css/myCSS.css" rel="stylesheet">-->
  
  
  <style>
/* Spinner Wrapper */
.loader {
width: 100vw;
height: 100vh;
background: white;
position: fixed;
top: 0;
left: 0;
}

.loader-inner {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
}


/* Spinner */
.lds-roller {
display: inline-block;
position: relative;
width: 64px;
height: 64px;
}
.lds-roller div {
animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
transform-origin: 32px 32px;
}
.lds-roller div:after {
content: " ";
display: block;
position: absolute;
width: 10px;
height: 13px;
border-radius: 50%;
background: #17a2b8;
margin: -3px 0 0 -3px;
}
.lds-roller div:nth-child(1) {
animation-delay: -0.036s;
}
.lds-roller div:nth-child(1):after {
top: 50px;
left: 50px;
}
.lds-roller div:nth-child(2) {
animation-delay: -0.072s;
}
.lds-roller div:nth-child(2):after {
top: 54px;
left: 45px;
}
.lds-roller div:nth-child(3) {
animation-delay: -0.108s;
}
.lds-roller div:nth-child(3):after {
top: 57px;
left: 39px;
}
.lds-roller div:nth-child(4) {
animation-delay: -0.144s;
}
.lds-roller div:nth-child(4):after {
top: 58px;
left: 32px;
}
.lds-roller div:nth-child(5) {
animation-delay: -0.18s;
}
.lds-roller div:nth-child(5):after {
top: 57px;
left: 25px;
}
.lds-roller div:nth-child(6) {
animation-delay: -0.216s;
}
.lds-roller div:nth-child(6):after {
top: 54px;
left: 19px;
}
.lds-roller div:nth-child(7) {
animation-delay: -0.252s;
}
.lds-roller div:nth-child(7):after {
top: 50px;
left: 14px;
}
.lds-roller div:nth-child(8) {
animation-delay: -0.288s;
}
.lds-roller div:nth-child(8):after {
top: 45px;
left: 10px;
}
@keyframes lds-roller {
  0% {
      transform: rotate(0deg);
  }
  100% {
      transform: rotate(360deg);
  }
}



/*Add animation to "page content" */
.animate-bottom {
position: relative;
-webkit-animation-name: animatebottom;
-webkit-animation-duration: 1s;
animation-name: animatebottom;
animation-duration: 1s
}

@-webkit-keyframes animatebottom {
from { bottom:-100px; opacity:0 }
to { bottom:0px; opacity:1 }
}

@keyframes animatebottom {
from{ bottom:-100px; opacity:0 }
to{ bottom:0; opacity:1 }
}
</style>
  
  
  


</head>
<body class="bg-gradient-info">
  
  
  
  
<!-- Loading Spinner Wrapper-->
<div class="loader text-center" id="loader">
<div class="loader-inner">

    <!-- Animated Spinner -->
    <div class="lds-roller mb-3">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- Spinner Description Text [For Demo Purpose]-->
    <h4 class="text-uppercase font-weight-bold">Ciao !</h4>
    <p class="font-italic text-muted">Attendi un attimo</p>
</div>
</div>
  



<div style="display:none;" id ="mainDiv" class="container">

 <!-- Outer Row -->
 <div class="row justify-content-center my-5">

   <div class="col-xl-10 col-lg-12 col-md-9 align-middle my-5">

     <div class="card o-hidden border-0 shadow-lg my-5">
       <div class="card-body p-5" >
         <!-- Nested Row within Card Body -->
         <div class="text-center">
           <h1 id="title" class="h4 text-gray-900 mb-4"></h1>
         </div>
         <div class="row">
          <!-- <div class="col-lg-6 d-none d-lg-block bg-login-image"></div>-->


           <div class="col-md-12 col-lg-6">
           <div class="px-0 py-5 px-lg-5">  <!--default:small -> padding sulla x 0(larghezza massima), padding sulla y di 5(top e bottom 5), padding sulla x dei dispositivi large di 5   -->
           <div class="text-center">
              <!--<h1 class="h4 text-gray-900 mb-4">&nbsp;</h1>-->
             <form data-toggle="validator" role="form" class="user">
              <div class="form-group has-feedback">
                      <!-- <div class="dropdown">-->
                       <div class="list-group" id="list-tab" role="tablist" style="height: auto;max-height: 250px;overflow-x: hidden;">
                         <!--<a class="list-group-item list-group-item-action active" id="aversa 1" data-toggle="list" href="Aversa 1" role="tab">Aversa 1</a>
                         <a class="list-group-item list-group-item-action" id="aversa 1" data-toggle="list" href="Aversa 1" role="tab">Aversa 1</a>
                         <a class="list-group-item list-group-item-action" id="aversa 2" data-toggle="list" href="#list-profile" role="tab">Aversa 2</a>
                         <a class="list-group-item list-group-item-action" id="leopardi 1" data-toggle="list" href="#list-messages" role="tab">Leopardi 1</a>
                         <a class="list-group-item list-group-item-action" id="leopardi 2" data-toggle="list" href="#list-settings" role="tab">Leopardi 2</a>
                         <a class="list-group-item list-group-item-action" id="aversa 2" data-toggle="list" href="#list-profile" role="tab">Aversa 2</a>
                         <a class="list-group-item list-group-item-action" id="leopardi 1" data-toggle="list" href="#list-messages" role="tab">Leopardi 1</a>-->
                        
                       </div>
                    <!--  </div>-->
                    </div>
              </form>
          </div>
          </div>
           </div>
           <div class="col-md-12 col-lg-6">
             <div class="px-0 py-5 px-lg-5">

               <form data-toggle="validator" role="form" class="user">
                 <div class="tab-content" id="nav-tabContent">
                   <!--<div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">Aversa 1</div>-->

                   <div class="form-group row">
                       <label for="staticEmail" class="col-sm-6 col-form-label">ENI:</label>
                       <div class="col-sm-6">
                         <input type="number" min="15" oninput="checkEmpty()" onkeypress="return isNumberKey(event)" class="form-control" id="inputEni" aria-describedby="ENI_obj" placeholder="-" name="inputEni" required>
                       </div>
                   </div>
                   <div class="form-group row">
                       <label for="staticEmail" class="col-sm-6 col-form-label">HERACOMM:</label>
                       <div class="col-sm-6">
                         <input type="number" min="15" oninput="checkEmpty()" onkeypress="return isNumberKey(event)" class="form-control" id="inputHeracomm" aria-describedby="HERACOMM_obj" placeholder="-" name="inputHeracomm" required>
                       </div>
                   </div>
                   <div class="form-group row">
                       <label for="staticEmail" class="col-sm-6 col-form-label">IBERDROLA:</label>
                       <div class="col-sm-6">
                         <input type="number" min="15" oninput="checkEmpty()" onkeypress="return isNumberKey(event)" class="form-control" id="inputIberdrola" aria-describedby="IBERDROLA_obj" placeholder="-" name="inputIberdrola" required>
                       </div>
                   </div>
                   <div class="form-group row">
                       <label for="staticEmail" class="col-sm-6 col-form-label">SINERGY:</label>
                       <div class="col-sm-6">
                         <input type="number" min="15" oninput="checkEmpty()" onkeypress="return isNumberKey(event)" class="form-control" id="inputSinergy" aria-describedby="SINERGY_obj" placeholder="-" name="inputSinergy" required>
                       </div>
                   </div>
                   <div class="form-group row">
                       <label for="staticEmail" class="col-sm-6 col-form-label">WIND:</label>
                       <div class="col-sm-6">
                         <input type="number" min="15" oninput="checkEmpty()" onkeypress="return isNumberKey(event)" class="form-control" id="inputWind" aria-describedby="WIND_obj" placeholder="-" name="inputWind" required>
                       </div>
                   </div>
                 </div>

               </form>

             </div>
           </div>
           
           <div class="text-center" style="margin: 0 auto;">
              <a id="endButton" href="https://salesdashboard.it/dashboard/dashboard/index.html" class="btn btn-success btn-user btn-block" role="button">Finito</a>
           </div>
           
           <div class="text-center" style="margin: 0 auto;">
          <!-- <a id="confermaButton" href="https://salesdashboard.it/dashboard/dashboard/index.html" class="btn btn-primary btn-user btn-block disabled" onclick="setObj()" role="button">-->
              <a id="confermaButton" class="btn btn-primary btn-user btn-block disabled" onclick="setObj()" role="button" style="color: white;">
             Conferma
           </a>
           </div>

         </div>
       </div>
     </div>

   </div>

 </div>

</div>



<!-- Bootstrap core JavaScript-->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="js/sb-admin-2.min.js"></script>

<!-- Page level plugins -->
<script src="vendor/chart.js/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0/dist/chartjs-plugin-datalabels.min.js"></script>



<!-- Per TABLE -->
<!-- Page level plugins -->
<script src="vendor/datatables/jquery.dataTables.min.js"></script>
<script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

<!-- Page level custom scripts -->
<script src="js/demo/datatables-demo.js"></script>

<!--<script src="jquery-1.10.2.min.js" type="text/javascript"></script>-->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.7/xlsx.core.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.core.min.js"></script>


<!--per le labels piechart-->
<script src="https://raw.githubusercontent.com/emn178/chartjs-plugin-labels/master/src/chartjs-plugin-labels.js"></script>
  
  

 
  
  
  

<script>
  var ufficiMese = [],dataSet=[]; 
  const URL1 = 'https://salesdashboard.it/dashboard/dashboard/report/ESTRAZIONE WIND.xlsx';   //con www da problemi di sicurezza
  const URL = 'https://salesdashboard.it/dashboard/dashboard/report/ESTRAZIONE ENERGIA.xlsx';
  var flag=0;
  
  
  
  
  var oFile,oFile1;

//FILE XLSX TRAMITE URL	(la prima volta verrà chiamata con il file energia.xlsx, la seconda con wind.xlsx)
$(document).ready(ExportToTableByURL(URL));
function ExportToTableByURL(url) {
//var regex = /^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)+([a-zA-Z0-9\s_\\.\-:])+(.xlsx|.xls)$/;
var regex = /(https?:\/\/)?([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/;

var request = new XMLHttpRequest();  //crea una richiesta http
request.open('POST',url, true);
request.setRequestHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet; charset=UTF-8');    //setto una header alla mia richiesta di tipo xslx
request.responseType = 'blob';         //la risposta DEVE essere di tipo blob (dati che possono essere letti come testo o bit o convertiti in readablestream)

request.onload = function(e) {
if (this.status === 200) {    //andata a buon fine
  blob = this.response;

  if(window.navigator.msSaveOrOpenBlob) {
    window.navigator.msSaveBlob(blob, "energia.xlsx");
  }
  else{
    oFile = new File([blob], "energia.xlsx", {type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
    //console.log("oFile xlsx creato da zero:");
    //console.log(oFile);


      //if (regex.test(oFile.name.toLowerCase())) {
          var xlsxflag = false; //Flag for checking whether excel is .xls format or .xlsx format
          if (oFile.name.toLowerCase().indexOf(".xlsx") > 0) {
              xlsxflag = true;
          }
          //Checks whether the browser supports HTML5
          if (typeof (FileReader) != "undefined") {
              var reader = new FileReader();


              reader.onload = function (e) {
                  var data = e.target.result;
                  //Converts the excel data in to object
                  if (xlsxflag) {
                      var workbook = XLSX.read(data, { type: 'binary' });
                  }
                  else {
                      var workbook = XLS.read(data, { type: 'binary' });
                  }
                  //Gets all the sheetnames of excel in to a variable
                  var sheet_name_list = workbook.SheetNames;

                  var cnt = 0; //This is used for restricting the script to consider only first sheet of excel
                  sheet_name_list.forEach(function (y) { //Iterate through all sheets
                      //Convert the cell value to Json
                      if (xlsxflag) {
                          //console.log("file xlsx rilevato1!!!");
                          var exceljson = XLSX.utils.sheet_to_json(workbook.Sheets[y]);
                      }
                      else {
                          var exceljson = XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);
                      }

                      if (exceljson.length > 0 && cnt == 0) {

            BindTable(exceljson, '#exceltable');
            if(flag == 0)
            flag=1;

                          cnt++;
                      }
                  });
                  //$('#exceltable').show();
              }

              if (xlsxflag) {//If excel file is .xlsx extension than creates a Array Buffer from excel
        //console.log("file xlsx rilevato2!!!");
                 //reader.readAsArrayBuffer(blob[0].files[0]);
        reader.readAsArrayBuffer(oFile);
              }
              else {
                  reader.readAsBinaryString($("#excelfile")[0].files[0]);
              }
          }
          else {
              alert("Sorry! Your browser does not support HTML5!");
          }
      /*}
      else {
          alert("Please upload a valid Excel file!");
      }*/

          }
         }
      };
      request.send();

}
  
  
  
  
  
  
  
  function BindTable(jsondata, tableid) {//Function used to convert the JSON array to Html Table

  if(flag == 0)
      columns = BindTableHeader(jsondata, tableid); //Gets all the column headings of Excel
  else
      brand = "WIND";

  for (var i = 0; i < jsondata.length; i++) {
        // for (var colIndex = 0; colIndex < columns.length; colIndex++) {

    if(flag==0)
     brand = jsondata[i][columns[3]];

   if(jsondata[i][columns[1]]){
     ufficio = jsondata[i][columns[1]];
    

      dataSet.push(ufficio);
    }

  }

  //console.log("energia: ");
  // console.log(dataSet);

  if(flag==0)
     ExportToTableByURL(URL1);
  else {
    createTableXLS(dataSet);
    //createPieChartMeseXLS(dataSetMese);
    //createPieChartGiornoXLS(dataSetGiorno);
  }
}




//PRENDE LE COLONNE VOLUTE NEI DATI JSON
function BindTableHeader(jsondata, tableid) {
     var columnSet = [];

     for (var i = 0; i < jsondata.length; i++) {
         var rowHash = jsondata[i];
         for (var key in rowHash) {
           //console.log("key: "+key);
           if(key == "Data creaz." || key == "Coordinatore CCeasy" || key == "Operatore CCeasy" || key == "Brand Energia"){
             if (rowHash.hasOwnProperty(key)) {
               if ($.inArray(key, columnSet) == -1) {
                 columnSet.push(key);

               }
             }
           }
         }
     }
     return columnSet;
}
  
  
  function createTableXLS(dataSet){

      var dataSetOff = [];
      var n_ufficiMese = [], prev;


      dataSet.sort();

      for ( var i = 0; i < dataSet.length; i++ ) {
        if ( dataSet[i] !== prev ) {
          ufficiMese.push(dataSet[i]);
          n_ufficiMese.push(1);
         
        } else {
          n_ufficiMese[n_ufficiMese.length-1]++;
         
        }
        prev = dataSet[i];
      }
    
    
     console.log("ufficiMESE obiettivi: "+ufficiMese);
     getData();
    
    
    
  }
  
</script>  
  
  
  
  
  

<script>
function setObj() //modal
{
   var obiettivi=[];
   var lista_el,ufficio,nUff = 25;
   active_element = document.getElementsByClassName("list-group-item list-group-item-action active");

   if(active_element[0]==undefined)
      alert("Seleziona una forza lavoro")
   else {
      ufficio = active_element[0].text;
      console.log("ufficio: "+ufficio);

      active_element[0].classList.add("list-group-item-success");
      active_element[0].classList.remove("active");
      //lista_el[1].classList.add("active");

      //$(".list-group-item list-group-item-action active").removeClass("list-group-item list-group-item-action active");
      //$(".list-group-item list-group-item-action active").addClass("list-group-item list-group-item-success");


      obiettivi[0] = document.getElementById('inputEni').valueAsNumber;
      obiettivi[1] = document.getElementById('inputHeracomm').valueAsNumber;
      obiettivi[2] = document.getElementById('inputIberdrola').valueAsNumber;
      obiettivi[3] = document.getElementById('inputSinergy').valueAsNumber;
      obiettivi[4] = document.getElementById('inputWind').valueAsNumber;

      document.getElementById('inputEni').value = null;
      document.getElementById('inputHeracomm').value = null;
      document.getElementById('inputIberdrola').value = null;
      document.getElementById('inputSinergy').value = null;
      document.getElementById('inputWind').value = null;
      $("#confermaButton").addClass("disabled");

      sendData(ufficio,obiettivi[0],obiettivi[1],obiettivi[2],obiettivi[3],obiettivi[4]);
    }
}

var today = new Date();
var dd = String(today.getDate()).padStart(2, '0');
var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
var yyyy = today.getFullYear();

function getData() {
  
 
  
  

   //today = yyyy + '-' + mm + '-' + dd;
   today = mm+'/'+yyyy;
  //console.log(today);
  $('#title').append(today+':&nbsp;&nbsp;&nbsp;Seleziona gli obiettivi!');
  
  
  //var uffici = ["Aversa 1","Aversa 2","Leopardi 1","Leopardi 2","Casapulla 1"];
  
  for(var i=0;i<ufficiMese.length;i++)
     $('#list-tab').append('<a class="list-group-item list-group-item-action" id="'+ufficiMese[i].toLowerCase()+'" data-toggle="list" href="Aversa 1" role="tab">'+ufficiMese[i]+'</a>');
   

  console.log("GET DATA... ");

 $.ajax({
   url: "getObiettivi2.php",
   type: 'GET',
   dataType: 'json',
   data: { 
    date: today,
   },
   success: function(response){
     
       console.log("response: "+response);
     
       var len = response.length;
       var ufficio,date,eni,heracomm,iberdrola,sinergy,wind;

       for(i=0; i<len; i++){
            ufficio = response[i].ufficio.toLowerCase();
         	//date = response[i].date; 		//nel php prendo direttamente solo i valori con la data corrente
            eni = Math.floor(response[i].eni);
            heracomm = Number(response[i].heracomm);
            iberdrola = Number(response[i].iberdrola);
            sinergy = Number(response[i].sinergy);
            wind = Number(response[i].wind);
         
         	//console.log("In questo mese sono già fissati gli obiettivi per: '"+ufficio+"'");
       		document.getElementById(ufficio).classList.add("list-group-item-success");
       }
     
       document.getElementById("loader").style.display = "none";
  	   document.getElementById("mainDiv").style.display = "block";
   },
   error: function(xhr, status, error) {
          console.log("errore: "+xhr.responseText);
           console.log("status: "+status);
      console.log("error: "+error);
     
   }
 });

}

function sendData(ufficio,eni,heracomm,iberdrola,sinergy,wind) {
  
  	  console.log("SEND DATA...");

      today = mm+'/'+yyyy;
  	  console.log(ufficio.toLowerCase()+" "+today+" "+eni+" "+wind);
  
      $.ajax({
       url: "sendObiettivi.php",
       type: 'POST', //send it through get method
       data: {
         ufficio: ufficio.toLowerCase(),
         date: today, 
         eni: eni,
         heracomm: heracomm,
         iberdrola: iberdrola,
         sinergy: sinergy,
         wind: wind,
       },
       success: function(response) {
         console.log(response);
       },
       error: function(xhr, status, error) {
           console.log(xhr.responseText);
       }
     });

}

 function checkEmpty(){
   
   var a=document.getElementById('inputEni').value;
   var b=document.getElementById('inputHeracomm').value;
   var c=document.getElementById('inputIberdrola').value;
   var d=document.getElementById('inputSinergy').value;
   var e=document.getElementById('inputWind').value;

   if(a=="" || a==null || a<15 ||
      b=="" || b==null || b<15 ||
      c=="" || c==null || c<15 ||
      d=="" || d==null || d<15 ||
	  e=="" || e==null || e<15
    ){
      console.log("qualcuno vuoto");
      $("#confermaButton").addClass("disabled");
   }
   else{
       console.log("tutti pieni");
       $("#confermaButton").removeClass("disabled");
   }

 }

 function isNumberKey(evt)
{
 var charCode = (evt.which) ? evt.which : evt.keyCode;
 if (charCode != 46 && charCode > 31  && (charCode < 48 || charCode > 57))
   return false;
 return true;
}


</script>



</body>
</html>
